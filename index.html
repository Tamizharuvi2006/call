<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Vidizzy Insta Call Clone</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
html, body {
  width: 100%;
  min-height: 100%;
  overflow-y: auto;
  background: #000;
  -webkit-overflow-scrolling: touch;
}
body {
  font-family: 'Segoe UI', sans-serif;
  display: flex;
  flex-direction: column;
  color: #fff;
}
.user-list {
  width: 100%;
  max-width: 250px;
  background: #111;
  padding: 10px;
  overflow-y: auto;
  flex-shrink: 0;
}
.user {
  padding: 12px;
  cursor: pointer;
  border-bottom: 1px solid #222;
}
.user:hover { background: #222; }
.main {
  flex: 1;
  width: 100%;
  min-height: 100vh;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #000;
  overflow: hidden;
}
.upload-section, .call-section {
  display: none;
  flex-direction: column;
  align-items: center;
  gap: 15px;
  padding: 20px;
}
.upload-section.active, .call-section.active {
  display: flex;
}
.upload-btn {
  background: #333;
  padding: 12px 20px;
  border: 2px dashed #555;
  color: #ccc;
  border-radius: 8px;
  cursor: pointer;
}
button {
  background: #0095f6;
  color: #fff;
  border: none;
  padding: 12px 20px;
  border-radius: 8px;
  cursor: pointer;
}
button:hover { background: #0074c2; }
.video-full, #localVideo.full {
  position: absolute;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: 1;
}
.video-pip, #localVideo.pip {
  position: absolute;
  bottom: 90px;
  right: 20px;
  width: 120px;
  height: 160px;
  object-fit: cover;
  border: 2px solid #fff;
  border-radius: 12px;
  cursor: grab;
  transition: all 0.3s ease;
  z-index: 2;
}
.controls {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 20px;
  background: rgba(0,0,0,0.5);
  border-radius: 40px;
  padding: 10px 15px;
  align-items: center;
  transition: transform 0.3s ease, opacity 0.3s ease;
  z-index: 3;
}
.controls.hidden {
  transform: translate(-50%, 100%);
  opacity: 0;
}
@media (max-width: 768px) {
  .controls {
    bottom: 60px;
  }
}
.controls button {
  background: transparent;
  border: none;
  color: #fff;
  font-size: 24px;
  cursor: pointer;
}
.controls button:hover { color: #1e90ff; }
#callTimer {
  font-size: 16px;
  color: #0f0;
  font-weight: bold;
}
</style>
</head>
<body>

<div class="user-list" id="userList">
  <div class="user">John üöÄ</div>
  <div class="user">Lisa üå∏</div>
  <div class="user">Mike üßë‚Äçüíª</div>
</div>

<div class="main">
  <!-- Upload Section -->
  <div class="upload-section active" id="uploadSection">
    <h3>Upload up to 5 videos to start call</h3>
    <label for="videoUpload" class="upload-btn">Upload Videos üìπ</label>
    <input type="file" id="videoUpload" accept="video/*" multiple hidden>
    <button id="startCall" disabled>Start Call</button>
  </div>

  <!-- Call Section -->
  <div class="call-section" id="callSection">
    <video id="remoteVideo" autoplay muted controls class="video-full"></video>
    <video id="localVideo" autoplay muted class="pip"></video>
    <div class="controls" id="controls">
      <div id="callTimer">00:00</div>
      <button id="muteBtn">üéôÔ∏è</button>
      <button id="switchCamBtn">üîÅ</button>
      <button id="switchViewBtn">üîÑ</button>
      <button id="endCallBtn">‚ùå</button>
    </div>
  </div>
</div>

<script>
const users = document.querySelectorAll('.user');
const userList = document.getElementById('userList');
const uploadSection = document.getElementById('uploadSection');
const callSection = document.getElementById('callSection');
const videoUpload = document.getElementById('videoUpload');
const startCallBtn = document.getElementById('startCall');
const remoteVideo = document.getElementById('remoteVideo');
const localVideo = document.getElementById('localVideo');
const muteBtn = document.getElementById('muteBtn');
const switchCamBtn = document.getElementById('switchCamBtn');
const switchViewBtn = document.getElementById('switchViewBtn');
const endCallBtn = document.getElementById('endCallBtn');
const callTimer = document.getElementById('callTimer');
const controls = document.getElementById('controls');

let uploadedVideos = [];
let currentVideoIndex = 0;
let muted = false;
let facingMode = "user";
let localStream;
let timerInterval;
let seconds = 0;
let isControlsVisible = true;

// Vibrate utility
function vibrate(ms=30) {
  if (navigator.vibrate) navigator.vibrate(ms);
}

// User click
users.forEach(user => {
  user.addEventListener('click', () => {
    vibrate();
    uploadSection.classList.add('active');
    callSection.classList.remove('active');
  });
});

// Upload video
videoUpload.addEventListener('change', (e) => {
  const files = Array.from(e.target.files).slice(0, 5);
  uploadedVideos = files.map(file => URL.createObjectURL(file));
  if (uploadedVideos.length > 0) startCallBtn.disabled = false;
});

// Start call
startCallBtn.addEventListener('click', () => {
  vibrate(50);
  uploadSection.classList.remove('active');
  callSection.classList.add('active');
  userList.style.display = "none";
  playVideosLoop();
  startCamera();
  startTimer();
});

// Play video loop with auto next
function playVideosLoop() {
  if (uploadedVideos.length > 0) {
    currentVideoIndex = 0;
    remoteVideo.src = uploadedVideos[currentVideoIndex];
    remoteVideo.play();
    remoteVideo.onended = playNextVideo;
  }
}

function playNextVideo() {
  currentVideoIndex = (currentVideoIndex + 1) % uploadedVideos.length;
  remoteVideo.src = uploadedVideos[currentVideoIndex];
  remoteVideo.play();
  remoteVideo.onended = playNextVideo;
}

// Start camera
function startCamera() {
  if (localStream) {
    localStream.getTracks().forEach(track => track.stop());
  }
  navigator.mediaDevices.getUserMedia({ video: { facingMode }, audio: true })
    .then(stream => {
      localStream = stream;
      localVideo.srcObject = stream;
    })
    .catch(err => alert("Camera/Mic Error: " + err));
}

// Switch camera
switchCamBtn.addEventListener('click', () => {
  vibrate();
  facingMode = (facingMode === "user") ? "environment" : "user";
  startCamera();
});

// Mute toggle
muteBtn.addEventListener('click', () => {
  vibrate();
  if (localStream) {
    muted = !muted;
    localStream.getAudioTracks().forEach(track => track.enabled = !muted);
    muteBtn.style.opacity = muted ? 0.5 : 1;
  }
});

// Switch view
function switchView() {
  vibrate();
  if (remoteVideo.classList.contains('video-full')) {
    remoteVideo.classList.remove('video-full');
    remoteVideo.classList.add('video-pip');
    localVideo.classList.remove('pip');
    localVideo.classList.add('full');
    remoteVideo.style.zIndex = "1";
    localVideo.style.zIndex = "2";
  } else {
    remoteVideo.classList.remove('video-pip');
    remoteVideo.classList.add('video-full');
    localVideo.classList.remove('full');
    localVideo.classList.add('pip');
    remoteVideo.style.zIndex = "2";
    localVideo.style.zIndex = "1";
  }
}
switchViewBtn.addEventListener('click', switchView);
remoteVideo.addEventListener('click', () => { if (!remoteVideo.classList.contains('video-full')) switchView(); });
localVideo.addEventListener('click', () => { if (!localVideo.classList.contains('full')) switchView(); });

// End call
endCallBtn.addEventListener('click', () => {
  vibrate(50);
  callSection.classList.remove('active');
  userList.style.display = "block";
  if (localStream) {
    localStream.getTracks().forEach(track => track.stop());
    localVideo.srcObject = null;
  }
  remoteVideo.pause();
  remoteVideo.src = "";
  uploadedVideos = [];
  currentVideoIndex = 0;
  uploadSection.classList.add('active');
  startCallBtn.disabled = true;
  stopTimer();
  callTimer.textContent = "00:00";
  seconds = 0;
});

// Timer
function startTimer() {
  timerInterval = setInterval(() => {
    seconds++;
    let mins = String(Math.floor(seconds / 60)).padStart(2, '0');
    let secs = String(seconds % 60).padStart(2, '0');
    callTimer.textContent = `${mins}:${secs}`;
  }, 1000);
}
function stopTimer() {
  clearInterval(timerInterval);
}

// Swipe-to-dismiss controls
let touchStartY = 0;
controls.addEventListener('touchstart', e => {
  touchStartY = e.touches[0].clientY;
});
controls.addEventListener('touchend', e => {
  const touchEndY = e.changedTouches[0].clientY;
  if (touchEndY - touchStartY > 50) {
    controls.classList.add('hidden');
  } else if (touchStartY - touchEndY > 50) {
    controls.classList.remove('hidden');
  }
});

// Draggable PiP
let isDragging = false, offsetX, offsetY;
localVideo.addEventListener('mousedown', startDrag);
localVideo.addEventListener('touchstart', startDrag);

function startDrag(e) {
  e.preventDefault();
  vibrate();
  isDragging = true;
  const rect = localVideo.getBoundingClientRect();
  offsetX = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
  offsetY = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
  document.addEventListener('mousemove', drag);
  document.addEventListener('touchmove', drag);
  document.addEventListener('mouseup', endDrag);
  document.addEventListener('touchend', endDrag);
}
function drag(e) {
  if (!isDragging) return;
  const x = (e.touches ? e.touches[0].clientX : e.clientX) - offsetX;
  const y = (e.touches ? e.touches[0].clientY : e.clientY) - offsetY;
  localVideo.style.left = x + 'px';
  localVideo.style.top = y + 'px';
}
function endDrag() {
  isDragging = false;
  document.removeEventListener('mousemove', drag);
  document.removeEventListener('touchmove', drag);
  document.removeEventListener('mouseup', endDrag);
  document.removeEventListener('touchend', endDrag);
}
</script>

</body>
</html>
